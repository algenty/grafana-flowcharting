<div role=" table" class="gf-table-main" id="TextsTable" style="overflow: visible;">
    <div class="gf-custom-scrollbar"
        style="position: relative; overflow: visible; width: 100%; height: auto; min-height: 0px; max-height: 100%;box-sizing: inherit;">
        <div class="gf-view"
            style="position: relative; overflow: visible; margin-right: -8px; margin-bottom: -8px; max-height: calc(100% + 8px);">
            <!-- THEAD -->
            <div class="gf-table-thead gf-unselectable" role="row" ng-mouseup="editor.textsTable.onMouseUp($event)"
                ng-mousemove="editor.textsTable.onMouseMove($event)"
                ng-mouseleave="editor.textsTable.onMouseUp($event)">
                <!-- HEADERS -->
                <!-- EXPAND -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('expand')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('expand')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('expand')}}</div>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize;"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
                <!-- WHAT -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('what')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('what')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('what')}}</div>
                    </div>
                    <div style="float: right;padding: 6px;width: 6px">
                        <info-popover mode="right-normal">
                            <span ng-bind-html="$GF.popover('Enter text Id or click on link button', 'SHAPES')">
                            </span>
                        </info-popover>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize;"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
                <!-- WHEN -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('when')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('when')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('when')}}</div>
                    </div>
                    <div style="float: right;padding: 6px;width: 6px">
                        <info-popover mode="right-normal">
                            <span ng-bind-html="$GF.popover('Select condition to metric on text.', 'SHAPES')">
                            </span>
                        </info-popover>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
                <!-- HOW -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('how')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('how')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('how')}}</div>
                    </div>
                    <div style="float: right;padding: 6px;width: 6px">
                        <info-popover mode="right-normal">
                            <span
                                ng-bind-html="$GF.popover('Whitch part of text to replace', 'TEXTS','example_text_pattern')">
                            </span>
                        </info-popover>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize;"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
                <!-- WITH -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('with')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('with')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('with')}}</div>
                    </div>
                    <div style="float: right;padding: 6px;width: 6px">
                        <info-popover mode="right-normal">
                            <span
                                ng-bind-html="$GF.popover('Enter pattern/regular expression (Only for substring method)', 'TEXTS','example_text_pattern')">
                            </span>
                        </info-popover>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize;"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
                <!-- ACTION -->
                <div class="gf-table-columnheader" colspan="1" role="columnheader"
                    ng-style="{'width' : editor.textsTable.getWidth('actions')}">
                    <div ng-attr-title="{{editor.textsTable.getDesc('actions')}}" class="gf-table-title"
                        style="cursor: pointer;">
                        <div>{{editor.textsTable.getLabel('actions')}}</div>
                    </div>
                    <div draggable="false" role="separator" class="gf-table-resizeHandle" style="cursor: ew-resize;"
                        ng-mousedown="editor.textsTable.onMouseDown($event)">
                    </div>
                </div>
            </div>
            <!-- TBODY -->
            <div class="gf-table-body">
                <div role="row" class="gf-table-rows-2 gf-table-rows-resizable" ng-repeat="text in rule.getTextMaps()"
                    ng-mouseenter="editor.setCurrentMap(text);" ng-mouseleave="editor.unsetCurrentMap();">
                    <!-- CELLS -->
                    <div class="gf-table-row_line"
                        ng-mouseleave="editor.unhighlightXCells(text);"
                        ng-mouseover="editor.highlightXCells(text)">
                        <!-- EXPAND -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="expand"
                            ng-click="text.reduce=!text.reduce"
                            ng-style="{'width' : editor.textsTable.getWidth('expand')}">
                            <div class="gf-table-content gf-unselectable" style="text-align: center; cursor: pointer;">
                                <span>
                                    <i class="fa fa-chevron-right" title="Expand/Collapse for detail"
                                        ng-class="{'gf-chevron-init': text.reduce, 'gf-chevron-rotate': text.reduce === false}">
                                    </i>
                                </span>
                            </div>
                        </div>
                        <!-- WHAT/PATTERN -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="what"
                            ng-mouseleave="text.displayWhatEdit = false;" ng-mouseover="text.displayWhatEdit = true;"
                            ng-style="{'width' : editor.textsTable.getWidth('what')}"
                            ng-attr-title="{{text.getData().pattern}}">
                            <div class="gf-table-content" ng-show="text.whatEdit !== true"
                                ng-dblclick="text.whatEdit = true;">
                                {{text.getData().pattern}}
                            </div>
                            <div ng-show="text.displayWhatEdit === true && text.whatEdit !== true"
                                ng-click="text.whatEdit = true;$GF.setFocus( text.uid + '-what' )"
                                title="Edit pattern"
                                class="gf-icon-action gf-icon-edit gf-icon-withcontent">
                            </div>
                            <div ng-show="text.displayWhatEdit === true && text.whatEdit !== true && !editor.flowchartHandler.isMapping(text)"
                                ng-click="editor.flowchartHandler.setMap(text, rule.getTextMapOptions())"
                                class="gf-icon-action gf-icon-target gf-icon-withcontent"
                                title="Select a text in diagram">
                            </div>
                            <input type="text" class="gf-form-input" ng-model="text.getData().pattern"
                                style="margin-right: 2px;width : 100%"
                                ng-attr-id="{{text.uid + '-what'}}"
                                ng-show="text.whatEdit === true" ng-model-onblur
                                ng-blur="editor.onRulesChange();text.whatEdit = false;"
                                bs-typeahead="rule.getTextMapOptions().identByProp !== 'metadata' ? editor.getCellNamesTypeHead : editor.getCellNamesMD"
                                data-min-length="0" data-items="100" data-placement="right" />
                        </div>
                        <!-- WHEN -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="when"
                            ng-mouseleave="text.displayWhenEdit = false;" ng-mouseover="text.displayWhenEdit = true;"
                            ng-style="{'width' : editor.textsTable.getWidth('when')}"
                            ng-attr-title="{{$GF.GetT4V( editor.textOn, text.getData().textOn)}}">
                            <!-- {{text.getData().TextOn}} -->
                            <div class="gf-table-content" style="text-align: left;" ng-show="text.whenEdit !== true">
                                {{$GF.GetT4V( editor.textOn, text.getData().textOn)}}
                            </div>
                            <div ng-show="text.displayWhenEdit === true && text.whenEdit !== true"
                                ng-click="text.whenEdit = true;$GF.setFocus( text.uid + '-when' )"
                                class="gf-icon-action gf-icon-edit gf-icon-withcontent" title="Edit condition">
                            </div>
                            <select class="gf-form-input" ng-model="text.getData().textOn" style="width:100%;"
                                ng-attr-id="{{text.uid + '-when'}}"
                                ng-blur="editor.onRulesChange();text.whenEdit = false;" ng-show="text.whenEdit === true"
                                ng-options="c.value as c.text for c in editor.textOn"
                                ng-change="editor.onRulesChange()">
                            </select>
                        </div>
                        <!-- HOW -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="how"
                            ng-mouseleave="text.displayHowEdit = false;" ng-mouseover="text.displayHowEdit = true;"
                            ng-style="{'width' : editor.textsTable.getWidth('how')}"
                            ng-attr-title="{{$GF.GetT4V(editor.textReplace, text.getData().textReplace)}}">
                            <!-- {{text.getData().style}} -->
                            <div class="gf-table-content" style="text-align: left;"
                                ng-attr-title="{{$GF.GetT4V(editor.textReplace, text.getData().textReplace)}}"
                                ng-show="text.howEdit !== true">
                                {{$GF.GetT4V(editor.textReplace, text.getData().textReplace)}}
                            </div>
                            <div ng-show="text.displayHowEdit === true && text.howEdit !== true"
                                ng-click="text.howEdit = true;$GF.setFocus( text.uid + '-how' )"
                                class="gf-icon-action gf-icon-edit gf-icon-withcontent" title="Edit method">
                            </div>
                            <select class="gf-form-input" ng-model="text.getData().textReplace" style="width:100%;"
                                ng-attr-id="{{text.uid + '-how'}}"
                                ng-blur="editor.onRulesChange();text.howEdit = false;" ng-show="text.howEdit === true"
                                ng-options="c.value as c.text for c in editor.textReplace"
                                ng-change="editor.onRulesChange()">
                            </select>
                        </div>
                        <!-- WITH -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="with"
                            ng-mouseleave="text.displayWithEdit = false;" ng-mouseover="text.displayWithEdit = true;"
                            ng-style="{'width' : editor.textsTable.getWidth('with')}"
                            ng-attr-title="{{text.getData().textPattern}}">
                            <!-- {{text.getData().textPattern}} -->
                            <div class="gf-table-content" style="text-align: left;"
                                ng-show="text.withEdit !== true && text.getData().textReplace == 'pattern'">
                                {{text.getData().textPattern}}
                            </div>
                            <div ng-show="text.displayWithEdit === true && text.withEdit !== true && text.getData().textReplace == 'pattern'"
                                ng-click="text.withEdit = true;$GF.setFocus( text.uid + '-with' )"
                                class="gf-icon-action gf-icon-edit gf-icon-withcontent"
                                title="Text or pattern to replace by value">
                            </div>
                            <input ng-if="text.getData().textReplace == 'pattern'"
                                style="margin-right: 2px;width : 100%" ng-attr-id="{{text.uid + '-with'}}"
                                type="text" class="gf-form-input" ng-show="text.withEdit === true"
                                ng-model="text.getData().textPattern"
                                ng-blur="editor.onRulesChange();text.withEdit = false;"
                                placeholder="Text or pattern to replace by value" />
                        </div>
                        <!-- OPTIONS/ACTION -->
                        <div role="cell" class="gf-table-cells gf-table-cells-resizable" id="options"
                            ng-style="{'width' : editor.textsTable.getWidth('actions')}">
                            <div class="gf-table-content gf-unselectable"
                                style="text-align: left;justify-content: center;">
                                <div ng-click="editor.removeTextMap(rule,$index);editor.onRulesChange()"
                                    title="Delete this mapping object" class="gf-icon-action gf-icon-remove">
                                </div>
                                <div ng-click="text.isHidden() ? text.show(): text.hide();editor.onRulesChange()"
                                    title="Enable/Disable this mapping" class="gf-icon-action"
                                    ng-class="{'gf-icon-show': !text.isHidden(), 'gf-icon-hide': text.isHidden()}">
                                </div>
                                <div ng-click="editor.flowchartHandler.setMap(text,rule.getTextMapOptions())"
                                    title="Select a shape in diagram" class="gf-icon-action"
                                    ng-class="{'gf-icon-target': !editor.flowchartHandler.isMapping(text), 'gf-icon-empty': editor.flowchartHandler.isMapping(text)}">
                                </div>
                                <div ng-click="rule.cloneTextMap(text);editor.onRulesChange();"
                                    title="Duplicate this mapping" class="gf-icon-action gf-icon-clone">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="gf-table-row_body" ng-show="text.reduce==false">
                        <ng-include src="GFPlugin.getPartialPath() + 'rules/labels/labelBody.html'"> </ng-include>
                    </div>
                </div>
            </div>
            <!-- TFOOTER -->
            <div class="gf-table-tfooter gf-unselectable">
                <div class="gf-table-columnfooter" colspan="1">
                    <div class="gf-form-inline">
                        <div class="gf-form" style="margin-right: 5px;">
                            <button class="btn btn-primary btn-small" ng-click="rule.addTextMap('');"
                                title="Add a text mapping to display value in a text">
                                <svg width="16" height="16" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor"
                                        d="M 200 450C 200 435 210 425 225 425C 225 425 425 425 425 425C 425 425 425 225 425 225C 425 210 435 200 450 200C 450 200 550 200 550 200C 565 200 575 210 575 225C 575 225 575 425 575 425C 575 425 775 425 775 425C 790 425 800 435 800 450C 800 450 800 550 800 550C 800 565 790 575 775 575C 775 575 575 575 575 575C 575 575 575 775 575 775C 575 790 565 800 550 800C 550 800 450 800 450 800C 435 800 425 790 425 775C 425 775 425 575 425 575C 425 575 225 575 225 575C 210 575 200 565 200 550C 200 550 200 450 200 450" />
                                </svg>
                                &nbsp;Add a mapping
                            </button>
                        </div>
                        <div class="gf-form" style="margin-right: 5px;">
                            <button class="btn btn-secondary btn-small" ng-click="editor.onRulesChange();"
                                title="Refresh/Apply">
                                <svg width="16" height="16" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="currentColor"
                                        d="M 535 114C 550 128 555 150 547 169C 539 188 521 200 500 200C 379 200 269 273 223 385C 186 474 194 572 242 652C 242 652 253 641 253 641C 262 632 275 626 289 627C 303 627 316 633 325 643C 332 650 336 660 337 670C 337 670 355 793 355 793C 357 809 352 825 341 836C 330 847 314 852 298 850C 298 850 175 832 175 832C 156 830 140 817 134 799C 128 781 133 761 146 747C 146 747 169 725 169 725C 94 615 78 473 130 347C 192 198 338 100 500 100C 513 100 526 105 535 114C 535 114 535 114 535 114M 852 181C 862 190 868 203 868 216C 868 230 863 243 854 253C 854 253 831 275 831 275C 906 385 922 527 870 653C 808 802 662 900 500 900C 482 900 465 891 456 875C 447 860 447 840 456 825C 465 809 482 800 500 800C 621 800 731 727 777 615C 814 526 806 428 758 348C 758 348 747 359 747 359C 733 373 712 377 693 369C 674 362 662 343 662 323C 662 323 662 217 662 217C 662 190 685 167 712 167C 712 167 818 167 818 167C 831 167 843 172 852 181C 852 181 852 181 852 181" />
                                </svg>
                                &nbsp;Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
